name: Sync to Hugging Face Space

on:
  push:
    branches: [ main ]

jobs:
  sync-to-hf:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0
        lfs: true

    - name: Push to Hugging Face Space
      env:
        HF_TOKEN: ${{ secrets.HF_WRITE_TOKEN }}
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
        
        git clone https://huggingface.co/spaces/daniela-veloz/WebSummarizer hf-space
        cd hf-space
        
        # Remove all files except .git
        find . -name ".git" -prune -o -type f -exec rm -f {} +
        find . -name ".git" -prune -o -type d -empty -delete 2>/dev/null || true
        
        # Copy all files from the source repo
        cp -r ../. .
        rm -rf .git
        mv ../hf-space/.git .
        
        # Configure git with HF token
        git remote set-url origin https://daniela-veloz:${HF_TOKEN}@git.hf.co/spaces/daniela-veloz/WebSummarizer
        
        # Commit and push changes
        git add .
        git commit -m "Sync from GitHub repo" || exit 0
        git push origin main